## Note

合约广告：

online-location

受众定向——数据加工、数据交易



竞价广告：

不再保证量，保证质





广告网络：

非实时竞价最合理的竞价方式是在click上竞价，即CPC计价方式；

因为如果按照impression计价的话，广告主不知该如何评估收费价值。

不足：不易支持定制化用户划分



计算广告学核心问题：
给特定用户（user）和特定上下文（媒体context）找到最合适的sponsor（demand），达到最大的ROI（一组展示，一组impression整体ROI）
优化角度：
1.特征提取：受众定向
2.宏观：竞价市场机制
（品牌广告量比质重要得多，效果广告质会比较重要点，量也重要）
3.强化学习：预测新的用户群和组合的点击率（试一试，探索）
4.重定向：推荐技术

系统角度：
1.候选查询：实时索引，广告能马上进来，放完得能马上下线
2。特征存储：No-sql
3.离线学习：Hadoop
4.在线学习：流计算
5.交易市场：实时竞价

在线广告系统，极高并发系统，Rightmedia每天展示百亿次广告交易。（exchange向DSP询价，然后100ms内给我反映，过了不等了）Latency严格要求，广告时间延时，对点击率（CTR）影响明显。

建模方面，dynamics，兴趣和关注迅速变化，买了鞋明天兴趣就不存在了

用户和上下文中多样信号一起用于检索广告候选（一次查询用户可能是几百个关键词的搜索）  



  优化：
1、特征提取：user和context打上标签
2、微观优化：点击率CTR预测
3、宏观优化：竞价市场机制设计
4、受限优化：在线分配
5、探索和利用：新的广告和新的用户的预测
6、个性化重定向：推荐技术

从系统角度看：
1、候选查询：实时索引
2、特征存储：No-sql技术
3、离线学习：Hadoop
4、在线学习：流计算
5、交易市场：实时竞价  



  find the best match between a given user u , in a given context c ,and a suitable ad a.

ROI
CTR 点击率

从优化角度来看
特征提取：受众定向
围观优化：CTR预测
宏观优化：竞价市场机制
受限优化：在线分配
强化学习：探索与利用
个性化重定向：推荐技术

从系统角度来看
候选查询：实时索引
特征存储：nosql 技术
离线学习：Hadoop
在线学习：流计算
交易市场：实时竞价  





  个性化是推荐的一个准则，
推荐：多样性、新鲜度、个性化

首要准则：
搜索：相关性，广告：ROI，推荐：用户需求  





ROI的优化是计算广告的一个核心任务；
ROI的分析：
*流量来源：比较难去优化
*流量创造的产出是ROI主要的优化方式
eCPM=点击率*单个点击价值





——CPM媒体最喜欢的变现模式，尤其是品牌广告无法衡量短期回报，品牌广告大都按CPM。（按照千次展示收钱，媒体喜欢）
——CPC：supply端估计CTR，媒体来做有优势，google可以准确估计CTR。demand端估计click value，这个媒体估不出来。
——CPA/CPS/ROI(return on investment)：另一个极端，必须产生转化才付钱。淘宝直通车按cps结算。问题是存在广告主造假或骗展示。

CPM:每千人展示成本，媒体不承担风险
CPS:每次点击成本，媒体承担一定风险
CPA/CPI...每次行动成本/每次安装成本；媒体承担所有风险，且不易估算价值，只对少数业态有效
中国媒体往往按天售卖
由广告网络估计CTR,由demand端估计点击价值

投资回报率ROI：
CPM：展示付费
CPC：点击付费
CPA：效果付费
CPS：收益付费



个性化是推荐的一个需求，两者并不一致
推荐还要关注多样性和新鲜度
推荐可以认为是同质化的广告
推荐可以做downstream流的优化；



在线广告系统
1、ad server，高并发投送系统，10毫秒实时决策，百亿次/天。根据consumer和context来决定投什么ad。
2、离线受众定向平台，数据挖掘和机器学习，如Hadoop分布式算法。
3、数据高速公路，把线上的广告和行为日志实时推送到其他平台，方便反馈和出结果。
4、流式计算平台，反作弊和计价。





  customized audience segmentation
给客户提供服务，自己划分人群
客户的信息要注入媒体，来投递广告
例如：京东商城回馈忠实用户，只有京东商城自己划分人群

AE：客户执行，投广告的人实际操作的系统

RTBD：向别人要广告
RTBS：别人向我要广告
ADX：广告交易平台  





## 12 

  在线分配（online allocation）：
广告三方博弈：Supplier，Sponser，Audience
推荐系统：媒体和用户

广告主reach用户有量的需求：一种是guarantee限制下限,另一non-guarantee有下限限制（广告主充了钱，你帮我投）量的限制完成质的优化，就是online allocation

二步图匹配问题
一边是合约库（广告主的广告）
另一边contact user（把可以contact的人通过targeting分成segment，再将合约广告以一定比例分过去）。与一般二部图不一样在于，是要实时的online的
受限优化的问题
解法：
\1. Adwords problem
b（ia）（具体的impress分给某个广告产生的收益乘以点击率）*x（ia）（0或1，这次分给这个广告商了没有）累加就是整个收益
Constrain：对每个广告商有一个Budget，小于等于Ba（已经充了一定的钱）

2.推广到Display ad problem
有一些是CPM
μ（ia）（点击率）*x（ia）
Constrain：
a.Demand contrain：对于固定广告主a来说，所有i个impression的和小于等于Ca（需要多少展示又或者充了多少钱，NGD的，可以少于）
b.Supply Contrain：对于固定的一个i，第i个Impression只能0或1，对所有广告来分，只有一个能成功为1，或者全部为0

Maximally Respresentive allocation(对Objective加工满足量的同时尽量接近自然分布）：
买加州人群就是按照加州自然分布的人群（男、女自然分布，但是假设一个人出高价买完了所有女性，虽然给他的量还是够，但是都是男性，就和广告主的本源产生冲突）于是优化，既要人群，又尽量自然分布（Objective或者Constrain是什么对问题本身不是最重要，可以调整，根据不同优化目的进行调整） 



 ## 13

框架流程：
在mapper中仅仅生成紧凑的统计量，其大小正比于模型参数量，与数据流无关
这样的流程可以抽象出来，而具体的模型算法只需要关注统计量计算和更新两个函数



  常用统计模型

指数族分布： 最大似然(Maximum likelihood, ML)估计可以通过充分统计量链接到数据

指数族混合分布：ML估计可以通过EM算法迭代得到。每个迭代中，我们使用上一个迭代的统计量更新模型。  

1. 指数族分布
   求最大似然估计：指数族分布，在得出充分统计量后，就不用跟原始数据打交道了，只依靠充分统计量就能求出来
2. 指数族混合分布：多个指数族分布的组合
   最大似然估计：通过EM算法迭代得到，每个迭代中，用上一个迭代的统计量更新模型

实际问题中能描述成指数族分布就用指数族分布，如果一个指数族分布不够描述就用指数族混合分布  、



Map/Reduce
分布式操作和容错机制由系统实现，应用级编程非常简单
高效：用调度计算来代替调度数据！

Storm根本逻辑是调度数据

> 真正海量数据问题都是用调度计算来做，storm这种调度数据操作只能说在大量数据及之下的问题上有优势。



## 14

效果（大->小）：
1. 重定向：如果曾经访问过广告主的网站，则打上一个标签——明确揭示推荐原因（对于用户），符合用户兴趣，广告在用户理解范围内
2. Hyper-local：地域定向（非常细，如一个楼），在mobile上做非常容易
3. look-alike：Demand side targeting，重定向的量很少，完全由广告主的网站量决定的。因此，Look-alike是做跟retargeting人群相似人群的targeting
4. 行为：广告在用户可以理解的范围内。根据用户历史行为（搜索过，访问过，线下行为
5. 上下文：不要干扰或打断用户正在进行的作业
6. 人口属性、地域（省，城市）：效果一般，但是方便跟广告商交流



受众定向方式:

1. 重定向
2. 上下文
3. 行为



  重定向：原来在某网站如宝马店买了车，然后再其他网站如淘宝给重定向知道他是之前买过宝马的人，再推荐宝马广告。

look alike就是宝马网站流量很小，但是提供你100个客户，然后广告商帮助寻找类似的人。

hyper local就是精细的地域，如天大，则推荐西门的小店。他们没有其他平台可以放广告，这是最好的。  



## 15 

九种用户原始行为排序:
Transaction
Pre-transaction
paid search click
ad click 
search click
search
share
page view
ad view





Long-term行为定向多日累计方式：
--- 滑动窗方式
若周期为28天，在计算新的一次时，需要访问28天的数据
--- 时间衰减方式
仅需昨天f和今天t





点击广告的行为
各种类型的行为简单相加
long-term 窗口：由行为的决策周期决定
阈值：长尾行为本身就有噪声,调阈值，找拐点！
用上tag有可能效果还差于无定向！



  行为定向其他问题
Session log
​    将各种行为日志整理成以用户ID为key的形式，完成作弊和无效行为作为标注，作为各数据处理模块的输入源
​    可以将targeting编程局部计算，大大方便整个流程

Long-term行为定向两种多日累积方式
​    滑动窗方式, 将所有行为累积
​    时间衰减方式(空间复杂度低，仅需昨天的f和今天的t)  





  任何一个URL转化为一个标签
任何一个Search标为一个标签
任何一个广告打上一个标签

不同Channel上的标签累加和 为 一个用户标签  





## 16

  Contextual targeting：当时兴趣打标签，半在线Near-line

cache：每一条是url和对应的keywords, topic等特征表
如果url在cache中，则返回对应keywords, topic等
如果某个url不在cache中，则返回空，同时出发爬虫和特征提取，得到页面的特征表，并更新cache收起

[![img](http://img2.ph.126.net/Q-yv8p3T45ScCLaBOd9Y0g==/3361937121933710048.jpg)](http://img2.ph.126.net/HFxn7CA_J-ZLTdima3HdZQ==/6630104593512616508.jpg)  



页面在第一次有广告需要展现是，返回空的上下文，随后用一个小爬虫提取页面的特征和tag加入到cache中，这样当前页面需要下次展现时，就有了当前页面的tag。这样的方式能够保证页面tag是比较新的





share在demand端很难找到有诉求的广告主，偏向于supply的一个因素
9种行为越往demand端信号越强，越向supply端信号越弱。
淘宝的数据时大量的transaction，即信号最强的数据，因此价值巨大。
用supply端的数据给用户打标签不是很有价值，即用用户浏览行为来打标签很不靠谱。
信号强弱是对于加标签的效果好坏来说的。



Near-line 上下文定向系统
对用户第一次访问的URL（不用爬虫），分钟级别内即时打标签，并设置标签失效时间。下一次用户访问这个URL时，依据这些标签推送对应的广告。



## 17

  Topic model的并行化

EM以及VBEM的并行化
AD-LDA：Gibbs Sampling的并行化
​    Mapper：在部分data上分别进行Gibbs sampling
​    Reducer：全局Update
文档的Topic model抽取可以认为是一个大量(而非海量)数据运算，采用类MPI架构的分布式计算架构(例如spark)回避map/reduce效率更高  





Gamma 多维Gamma分布
Poisson 泊松分布
Multinomial 多项式分布
Dirichlet  狄利克雷分布：狄利克雷分布是一组连续多变量概率分布，是多变量普遍化的Β分布。为了纪念德国数学家约翰·彼得·古斯塔夫·勒热纳·狄利克雷（Peter Gustav Lejeune Dirichlet）而命名。狄利克雷分布常作为贝叶斯统计的先验概率。当狄利克雷分布维度趋向无限时，便成为狄利克雷过程（Dirichlet process）。狄利克雷分布奠定了狄利克雷过程的基础，被广泛应用于自然语言处理特别是主题模型（topic model）的研究。



页面主题分析 Topic Model
问题：发现一组文档中抽象的主题(topics)
常用模型图表示：
PLSI
LDA
GaP



## 18

越靠近demand的行为越有效
越主动的行为越有效
去除热门信息带来的偏差，我常看钓鱼岛并不是我喜欢钓鱼岛，这是一个热点，我是被动关注的。





数据管理平台
1. 为网站提供数据加工和对外交易能力
2. 加工跨媒体用户标签，提供大量细分类别，在交易市场中售卖，例如bluekai



  DMP
目的：
· 为网站提供数据加工和对 外交易能力
· 加工跨媒体用户标签，在交易市场中售卖
· 是否直接从事广告交易？ Bluekai售卖只数据，但是利润比较薄，AudienceScience则售卖广告。

关键特征：
· 统一的对外数据接口。对接ADN的访客找回（Retargeting）时，ADN需要在媒体上布js beacon，以定位来访的用户。而如果已有dmp，可直接向ADN提供用户识别数据，不用重复布js beacon。

做两件事：
· Audience Targeting、上下文标签
· 标签售卖

DMP收集日志，需要用到Data Highway。
具体工具有：Scribe、Flume、Chukwa

竞品 BlueKai 分析
核心业务：
· 为中小网站主提供数据加工和变现的方式
· 通过汇聚众多中小网站用户资料和行为数据，加工成受众定向标签，通过Data exchange对外售卖。因为覆盖面广，标签准确度高。
· 提供大量细分类别、开放体系上的标签  





  有价值的数据

广告商(Demand)数据
   简单的cookie植入可以用于retargeting
​    对接广告商种子人群可以做look-alike，提高覆盖率

用户属性和精准地理位置
​    非媒体广告网络很难获取，需通过第三方数据对接
​    移动互联和HTML5为获得地理位置提供了便利性

社交网络
​    朋友关系为用户兴趣和属性的平缓提供了机会
​    实名社交网络的人口属性信息相对准确  





  有价值的数据

用户标识
​    除去上下文和地域外各种定向的基础，需要长期积累和不断建设
​    可以通过多家第三方Id绑定不断优化

用户行为
​    业界工人有效行为数据(按有效性排序)：交易，预交易，搜索广告点击，广告点击，搜索，搜索点击，网页浏览，分享，广告浏览
​    需去除网络热点话题带来的偏差
​    越靠近demand的行为对转化越有贡献
​    越主动的行为越有效  